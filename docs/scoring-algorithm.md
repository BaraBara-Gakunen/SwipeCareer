# マッチングスコアリングアルゴリズム

## 概要

SwipeCareerのマッチングスコアは、ユーザーと企業の相性を **0〜100点** で数値化します。

このスコアは以下の2つの要素から構成されます：

- **適性マッチ度（Aptitude Score）**: 60%
- **興味マッチ度（Interest Score）**: 40%

```
最終マッチングスコア = 適性マッチ度 × 0.6 + 興味マッチ度 × 0.4
```

---

## 1. 適性マッチ度（Aptitude Score）

企業が求める特性（`wants`）とユーザーの自己分析スコアのマッチングを評価します。

### 計算方法

1. **スコアの正規化**
   - 自己分析の生スコアを0〜1の範囲に正規化
   - 最小値: `-30` (30問全てで-1点)
   - 最大値: `+120` (30問全てで+4点)
   
   ```
   正規化スコア = (生スコア - 最小値) / (最大値 - 最小値)
   ```

2. **マッチ判定**
   - 企業が求める各特性について、生スコアが正の値（`> 0`）の場合のみマッチとみなす
   - マッチした特性の正規化スコアを合計

3. **適性スコアの算出**
   ```
   平均正規化スコア = マッチした特性の正規化スコアの合計 / マッチした特性の数
   マッチ率 = マッチした特性の数 / 企業が求める特性の総数
   適性マッチ度 = 平均正規化スコア × マッチ率 × 100
   ```

### 特徴

- **バランス重視**: 1つの特性だけが突出して高得点でも、他が低ければスコアは上がらない
- **カバレッジ評価**: 企業が求める特性をどれだけ広くカバーしているかを評価
- **公平性**: 企業のwants数に依存しない（マッチ率で調整）

### 例

**企業A** が求める特性: `["Innovative", "Logical", "ChallengeLover", "ResultOriented", "Curious"]` (5個)

**ユーザーの自己分析スコア**:
- `Innovative`: 80 (正規化: 0.73)
- `Logical`: 60 (正規化: 0.60)
- `ChallengeLover`: 40 (正規化: 0.47)
- `ResultOriented`: -10 (負の値なのでマッチせず)
- `Curious`: 100 (正規化: 0.87)

**計算**:
- マッチした特性: 4個（`ResultOriented`を除く）
- 平均正規化スコア: (0.73 + 0.60 + 0.47 + 0.87) / 4 = 0.6675
- マッチ率: 4 / 5 = 0.8
- 適性マッチ度: 0.6675 × 0.8 × 100 = **53.4点**

---

## 2. 興味マッチ度（Interest Score）

企業のタグ（`tags`）とユーザーの企業分析スコアのマッチングを評価します。

### 計算方法

1. **スコアの正規化**
   - 企業分析の生スコアを0〜1の範囲に正規化
   - 最小値: `-50` (推定: 50タグ評価機会で全て-1点)
   - 最大値: `+200` (推定: 50タグ評価機会で全て+4点)

2. **マッチ判定**
   - 企業の各タグについて、生スコアが正の値（`> 0`）の場合のみマッチとみなす

3. **興味スコアの算出**
   ```
   平均正規化スコア = マッチしたタグの正規化スコアの合計 / マッチしたタグの数
   マッチ率 = マッチしたタグの数 / 企業のタグ総数
   興味マッチ度 = 平均正規化スコア × マッチ率 × 100
   ```

### 特徴

- **好み反映**: ユーザーが「好き」と評価した企業特性を持つ企業を優先
- **多様性評価**: 企業の複数の魅力的な側面に興味を持っているかを評価
- **公平性**: 企業のtags数に依存しない（マッチ率で調整）

---

## 3. 最終スコアの統合

```
最終マッチングスコア = 適性マッチ度 × 0.6 + 興味マッチ度 × 0.4
```

### 重み付けの理由

- **適性（60%）**: ユーザーが企業の求める人物像に合っているかは最重要
- **興味（40%）**: ユーザーが企業に興味を持っているかも重要だが、適性ほどではない

### スコアの解釈

| スコア範囲 | 評価 | 説明 |
|-----------|------|------|
| 80〜100 | 🟢 **非常に高い** | 適性・興味ともに高く、強く推奨 |
| 60〜79 | 🔵 **高い** | バランスが良く、推奨 |
| 40〜59 | 🟡 **中程度** | 一部マッチするが、検討の余地あり |
| 0〜39 | ⚪ **低い** | マッチ度が低い |

---

## 4. アルゴリズムの利点

### 正規化による公平性
- 質問数や企業の特性数に依存しない
- 全ての企業を同じ基準で比較可能

### マッチ率による質の評価
- 単一の高得点特性だけでなく、広範囲なマッチを重視
- 企業が求める多様な特性をバランスよく満たすユーザーを高く評価

### 透明性
- 各特性の個別スコアも表示
- なぜその企業がマッチしたのかユーザーに説明可能

### 拡張性
- 重み付け（0.6 / 0.4）は簡単に調整可能
- 新しい評価軸（例: 企業規模の好みスコア）を追加しやすい

---

## 5. コード実装

### 主要な定数

```typescript
// 自己分析スコアの範囲
const CHARACTERISTIC_SCORE_MIN = -30;  // 30問全てで-1
const CHARACTERISTIC_SCORE_MAX = 120;  // 30問全てで+4

// 企業分析スコアの範囲
const TAG_SCORE_MIN = -50;             // 推定: 50タグ評価機会で全て-1
const TAG_SCORE_MAX = 200;             // 推定: 50タグ評価機会で全て+4

// 重み付け
const APTITUDE_WEIGHT = 0.6;  // 適性マッチ度の重み
const INTEREST_WEIGHT = 0.4;  // 興味マッチ度の重み
```

### 正規化関数

```typescript
const normalizeScore = (score: number, min: number, max: number): number => {
  if (max === min) return 0.5;
  const normalized = (score - min) / (max - min);
  return Math.max(0, Math.min(1, normalized)); // 0〜1にクランプ
};
```

### 実装ファイル

- **`src/app/results/backend.ts`**: 最終マッチング計算（適性 + 興味）
- **`src/app/company-analysis/backend.ts`**: 企業フィルタリング（適性のみ）

---

## 6. 今後の改善案

### A. 動的な重み付け
ユーザーの選択パターンから自動的に重み付けを調整

### B. 時系列での学習
ユーザーの興味の変化を追跡して、より最近の選択を重視

### C. 追加の評価軸
- 企業規模の好み
- 勤務地の好み
- 給与レンジとのマッチ

### D. 説明可能性の強化
- 「なぜこのスコアになったか」の詳細な説明文生成
- ユーザーの強み・弱みの可視化

---

## 7. まとめ

このアルゴリズムは、ユーザーと企業の適性と興味を総合的に評価し、0〜100点の直感的なスコアで表現します。正規化とマッチ率の組み合わせにより、公平で透明性の高いマッチングを実現しています。
